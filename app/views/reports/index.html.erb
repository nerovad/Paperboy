<%# app/views/reports/index.html.erb %>
<div class="form-header">
  <h1>Generate Reports</h1>
</div>

<div class="form-wrapper reports-wrapper">
  <%= form_with url: reports_generate_path, method: :post, local: true do |f| %>
    
    <%# Form Selection %>
    <div class="form-group">
      <%= f.label :form_type, "Select Form", class: "form-label" %>
      <%= f.select :form_type, 
        options_for_select(@forms.map { |form| [form[:name], form[:value]] }, params[:form_type]),
        { prompt: "Choose a form..." },
        { class: "form-control", required: true }
      %>
      <small class="help-text">Select the form type you want to generate reports for</small>
    </div>

    <%# Date Range %>
    <div class="form-row">
      <div class="form-group flex-fill">
        <%= f.label :start_date, "Start Date", class: "form-label" %>
        <%= f.date_field :start_date, 
          class: "form-control", 
          required: true,
          value: params[:start_date] || 1.month.ago.to_date
        %>
        <small class="help-text">Beginning of date range</small>
      </div>

      <div class="form-group flex-fill">
        <%= f.label :end_date, "End Date", class: "form-label" %>
        <%= f.date_field :end_date, 
          class: "form-control", 
          required: true,
          value: params[:end_date] || Date.today
        %>
        <small class="help-text">End of date range</small>
      </div>
    </div>

    <%# Format Selection %>
    <div class="form-group">
      <%= f.label :format, "Export Format", class: "form-label" %>
      <%= f.select :format,
        [["PDF (Individual files in ZIP)", "pdf"], ["CSV (Single spreadsheet)", "csv"]],
        {},
        { class: "form-control", required: true }
      %>
      <small class="help-text">PDF creates individual files for each submission; CSV creates one spreadsheet with all data</small>
    </div>

    <%# Information Box %>
    <div class="info-box">
      <strong>How it works:</strong>
      <ul>
        <li>Select a form and date range above</li>
        <li><strong>PDF format:</strong> Creates an individual PDF for each submission, packaged into a ZIP file</li>
        <li><strong>CSV format:</strong> Creates one spreadsheet with all submissions in rows (opens in Excel)</li>
        <li>You'll receive an email when your report is ready for download</li>
        <li>Large reports may take several minutes to generate</li>
      </ul>
    </div>

    <%# Submit Button %>
    <%= f.submit "Generate Report", 
      class: "btn approve",
      data: { disable_with: "Generating..." },
      onclick: "return confirm('This will generate PDFs for all matching submissions. Continue?');"
    %>

  <% end %>
</div>
