<div class="form-header">
  <h1>Billing Tools</h1>
</div>

<!-- Mount BOTH controllers here so confirm is an ancestor of the buttons -->
<div class="form-wrapper" data-controller="billing-tools confirm">
  <!-- Start/End Date Row -->
  <div class="form-row">
    <div class="form-group">
      <%= label_tag :s_date, "Start Date" %>
      <%= date_field_tag :s_date, @sDate, class: "form-control", data: { billing_tools_target: "startDate" } %>
    </div>

    <div class="form-group">
      <%= label_tag :e_date, "End Date" %>
      <%= date_field_tag :e_date, @eDate, class: "form-control", data: { billing_tools_target: "endDate" } %>
    </div>
  </div>

  <!-- Buttons Grid -->
  <div class="billing-button-grid">
    <%= form_with url: backup_staging_billing_tools_path, method: :post, local: true, data: { turbo: false } do %>
      <%= submit_tag "Get Raw Data",
        class: "billing-btn raw-data",
        data: {
          action: "click->confirm#open",
          confirm_title: "Get Raw Data",
          confirm_message: "Run the raw data query for the selected dates?"
        } %>
    <% end %>

    <%= form_with url: backup_staging_billing_tools_path, method: :post, local: true, data: { turbo: false } do %>
      <%= submit_tag "Backup Staging",
        class: "billing-btn backup",
        data: {
          action: "click->confirm#open",
          confirm_title: "Backup Staging",
          confirm_message: "Create a fresh backup of the staging database?"
        } %>
    <% end %>

    <%= form_with url: run_monthly_billing_billing_tools_path, method: :post, local: true, data: { turbo: false } do %>
      <%= hidden_field_tag :s_date %>
      <%= hidden_field_tag :e_date %>
      <%= submit_tag "Run Monthly Billing",
        class: "billing-btn billing",
        data: {
          action: "click->confirm#open",
          confirm_title: "Run Monthly Billing",
          confirm_message: "Kick off MonthlyBilling with the current Start/End dates?"
        } %>
    <% end %>

    <%= form_with url: backup_staging_billing_tools_path, method: :post, local: true, data: { turbo: false } do %>
      <%= submit_tag "Print Reports",
        class: "billing-btn reports",
        data: {
          action: "click->confirm#open",
          confirm_title: "Print Reports",
          confirm_message: "Generate and print billing reports for the selected period?"
        } %>
    <% end %>

    <%= form_with url: backup_staging_billing_tools_path, method: :post, local: true, data: { turbo: false } do %>
      <%= submit_tag "Email Reports",
        class: "billing-btn email",
        data: {
          action: "click->confirm#open",
          confirm_title: "Email Reports",
          confirm_message: "Email billing reports to recipients now?"
        } %>
    <% end %>

    <%= form_with url: backup_production_billing_tools_path, method: :post, local: true, data: { turbo: false } do %>
      <%= submit_tag "Backup Production",
        class: "billing-btn prod-back",
        data: {
          action: "click->confirm#open",
          confirm_title: "Backup Production",
          confirm_message: "Back up the production database? This may take a while."
        } %>
    <% end %>
  </div>

  <!-- Confirm Modal (now just targets, no controller) -->
  <div class="modal" data-confirm-target="backdrop">
    <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="confirm-title">
      <span class="close" data-action="click->confirm#cancel" aria-label="Close">&times;</span>
      <h3 id="confirm-title" data-confirm-target="title">Confirm</h3>
      <p data-confirm-target="message">Are you sure you want to proceed?</p>
      <div style="display:flex; gap:0.75rem; justify-content:center; margin-top:1rem;">
        <button type="button" class="btn deny" data-action="click->confirm#cancel">Cancel</button>
        <button type="button" class="btn approve" data-action="click->confirm#proceed">Yes, do it</button>
      </div>
    </div>
  </div>
</div>
