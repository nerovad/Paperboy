<!-- app/views/rm75i_forms/new.html.erb -->
<div class="form-header">
  <h1>RM-75i: Accident / Near-Miss Investigation Report</h1>
</div>

<div class="form-wrapper">
  <%= form_with model: @rm75i_form, local: true do |form| %>
    <!-- Link to Event if coming from RM-75 -->
    <%= form.hidden_field :event_id, value: @prefill_event_id || params[:event_id] %>

    <!-- Page 1: Employee & Agency (UNBOUND where not in rm75i_forms) -->
    <div class="form-page">
      <h2>Employee & Agency</h2>

      <div class="form-row d-flex flex-wrap">
        <!-- UNBOUND employee_id for Event creation -->
        <div class="form-group flex-fill">
          <%= label_tag :employee_id, "Employee ID" %>
          <%= text_field_tag :employee_id, @prefill_data[:employee_id], class: "form-control", readonly: true %>
        </div>

        <!-- Optional unbound display fields -->
        <div class="form-group flex-fill">
          <%= label_tag :employee_name, "Employee Name" %>
          <%= text_field_tag :employee_name, @prefill_data[:name], class: "form-control", readonly: true %>
        </div>
      </div>

      <div data-controller="gsabss-selects" class="form-row d-flex flex-wrap">
        <div class="form-group">
          <%= label_tag :agency, "Agency" %>
          <%= select_tag :agency,
                options_for_select(@agency_options, @prefill_data[:agency]),
                class: "form-control", id: "agency-select",
                data: { gsabss_selects_target: "agency", action: "change->gsabss-selects#loadDivisions" } %>
        </div>

        <div class="form-group">
          <%= label_tag :division, "Division" %>
          <%= select_tag :division,
                options_for_select(@division_options, @prefill_data[:division]),
                class: "form-control", id: "division-select",
                data: { gsabss_selects_target: "division", action: "change->gsabss-selects#loadDepartments" } %>
        </div>

        <div class="form-group">
          <%= label_tag :department, "Department" %>
          <%= select_tag :department,
                options_for_select(@department_options, @prefill_data[:department]),
                class: "form-control", id: "department-select",
                data: { gsabss_selects_target: "department", action: "change->gsabss-selects#loadUnits" } %>
        </div>

        <div class="form-group">
          <%= label_tag :unit, "Unit" %>
          <%= select_tag :unit,
                options_for_select(@unit_options, @prefill_data[:unit]),
                class: "form-control", id: "unit-select",
                data: { gsabss_selects_target: "unit" } %>
        </div>
      </div>
    </div>

    <!-- Page 2: Investigation Details (BOUND) -->
    <div class="form-page" style="display:none;">
      <h2>Investigation Details</h2>
      <div class="form-row d-flex flex-wrap">
        <div class="form-group flex-fill">
          <%= form.label :investigator_name %>
          <%= form.text_field :investigator_name, class: "form-control" %>
        </div>
        <div class="form-group flex-fill">
          <%= form.label :investigator_title %>
          <%= form.text_field :investigator_title, class: "form-control" %>
        </div>
        <div class="form-group flex-fill">
          <%= form.label :investigator_phone %>
          <%= form.text_field :investigator_phone, class: "form-control" %>
        </div>

        <div class="form-group flex-fill">
          <%= form.label :incident_nature, "Nature of Incident (What occurred?)" %>
          <%= form.text_area :incident_nature, class: "form-control" %>
        </div>
        <div class="form-group flex-fill">
          <%= form.label :incident_cause, "Cause of Incident" %>
          <%= form.text_area :incident_cause, class: "form-control" %>
        </div>
      </div>

      <!-- Optional UNBOUND fields you previously showed; keep if you want them visible only
      <div class="form-row d-flex flex-wrap">
        <div class="form-group flex-fill"><%= label_tag :date_of_injury %><%= date_field_tag :date_of_injury, nil, class: "form-control" %></div>
        <div class="form-group flex-fill"><%= label_tag :time_occurred, "Time Occurred" %><%= text_field_tag :time_occurred, nil, class: "form-control" %></div>
        <div class="form-group flex-fill"><%= label_tag :incident_location %><%= text_field_tag :incident_location, nil, class: "form-control" %></div>
      </div>
      -->
    </div>

    <!-- Page 3: Severity & Root Cause (BOUND) -->
    <div class="form-page" style="display:none;">
      <h2>Severity & Root Cause</h2>
      <div class="form-row d-flex flex-wrap">
        <div class="form-group flex-fill">
          <%= form.label :root_cause %>
          <%= form.text_area :root_cause, class: "form-control" %>
        </div>
        <div class="form-group flex-fill">
          <%= form.label :severity_potential, "Assessment of Future Severity Potential" %>
          <%= form.text_field :severity_potential, class: "form-control" %>
        </div>
        <div class="form-group flex-fill">
          <%= form.label :recurrence_probability, "Assessment of Probability of Recurrence" %>
          <%= form.text_field :recurrence_probability, class: "form-control" %>
        </div>
      </div>
    </div>

    <!-- Page 4: Corrective Actions (BOUND) -->
    <div class="form-page" style="display:none;">
      <h2>Corrective Actions</h2>
      <div class="form-row d-flex flex-wrap">
        <div class="form-group flex-fill">
          <%= form.label :corrected_immediately, "Unsafe condition corrected immediately?" %>
          <%= form.select :corrected_immediately, options_for_select([["No", false], ["Yes", true]], false), {}, class: "form-control" %>
        </div>
        <div class="form-group flex-fill">
          <%= form.label :procedures_modified, "Checklist/procedures/training modified?" %>
          <%= form.select :procedures_modified, options_for_select([["No", false], ["Yes", true]], false), {}, class: "form-control" %>
        </div>

        <div class="form-group flex-fill">
          <%= form.label :responsible_person, "Person Responsible for Corrective Action" %>
          <%= form.text_field :responsible_person, class: "form-control" %>
        </div>
        <div class="form-group flex-fill">
          <%= form.label :responsible_title, "Title" %>
          <%= form.text_field :responsible_title, class: "form-control" %>
        </div>
        <div class="form-group flex-fill">
          <%= form.label :responsible_department, "Department" %>
          <%= form.text_field :responsible_department, class: "form-control" %>
        </div>
        <div class="form-group flex-fill">
          <%= form.label :responsible_phone, "Phone" %>
          <%= form.text_field :responsible_phone, class: "form-control" %>
        </div>

        <div class="form-group flex-fill">
          <%= form.label :target_completion_date, "Targeted Completion Date" %>
          <%= form.date_field :target_completion_date, class: "form-control" %>
        </div>
        <div class="form-group flex-fill">
          <%= form.label :actual_completion_date, "Actual Completion Date" %>
          <%= form.date_field :actual_completion_date, class: "form-control" %>
        </div>
      </div>
    </div>

    <!-- Page 5: OSHA Info (BOUND) -->
    <div class="form-page" style="display:none;">
      <h2>OSHA Info</h2>
      <div class="form-row d-flex flex-wrap">
        <div class="form-group flex-fill">
          <%= form.label :osha_recordable, "OSHA Recordable?" %>
          <%= form.select :osha_recordable, options_for_select([["No", false], ["Yes", true]], false), {}, class: "form-control" %>
        </div>
        <div class="form-group flex-fill">
          <%= form.label :osha_reportable, "OSHA Reportable?" %>
          <%= form.select :osha_reportable, options_for_select([["No", false], ["Yes", true]], false), {}, class: "form-control" %>
        </div>
        <div class="form-group flex-fill">
          <%= form.label :reportable_injury_codes, "Reportable Injury Codes" %>
          <%= form.text_area :reportable_injury_codes, class: "form-control" %>
        </div>
      </div>
    </div>

    <!-- Nav + Progress -->
    <div class="navigation-buttons d-flex justify-content-between">
      <div>
        <button type="button" id="prevBtn" style="display: none;">Previous</button>
      </div>
      <div>
        <button type="button" id="nextBtn">Next</button>
        <%= form.submit "Submit", style: "display: none;" %>
      </div>
    </div>

    <div class="progress-wrapper">
      <div class="progress-bar-container"><div class="progress-bar" id="progressBar"></div></div>
      <div class="progress-dots"><% 5.times do |i| %><div class="dot <%= 'active' if i == 0 %>"></div><% end %></div>
    </div>
  <% end %>
</div>
