<%# app/views/shared/_sidebar.html.erb %>
<button class="hamburger-btn" data-controller="sidebar" data-action="click->sidebar#toggle">
  <span class="navbar-toggler-icon"></span>
</button>

<!-- Overlay -->
<div class="sidebar-overlay" data-controller="sidebar" data-action="click->sidebar#close"></div>

<div class="sidebar" data-controller="sidebar-search">
  <h2>Available Forms</h2>
  <% if current_user %>
    <input
      type="text"
      placeholder="Search forms, fields, tags..."
      data-sidebar-search-target="input"
      data-action="input->sidebar-search#filter"
      class="sidebar-search-input"
    />
    <% 
    # Most forms are public (available to all employees)
    public_forms = [
      ["Billing Tools", new_billing_tool_path],
      ["Creative Job Request", new_creative_job_request_path],
      ["Critical Information Reporting", new_critical_information_reporting_path],
      ["Parking Permit Application", new_parking_lot_submission_path],
      ["Probation Agency Transfer Request", new_probation_transfer_request_path],
      ["Carpool Form", new_carpool_form_path],
      ["Gym Locker Form", new_gym_locker_form_path],
      ["Social Media Form", new_social_media_form_path],
      ["Work Schedule Or Location Update Form", new_work_schedule_or_location_update_form_path],
    ]
    
    # Build available forms list
    available_forms = public_forms.dup

    # Cache form templates with their field labels and tags for search
    form_field_labels = {}
    form_tags = {}
    FormTemplate.includes(:form_fields).each do |template|
      form_field_labels[template.name] = template.form_fields.pluck(:label).join(", ")
      form_tags[template.name] = template.tags_array.join(", ")
    end
    %>
    <div data-sidebar-search-target="formsList">
      <% available_forms.sort_by { |f| f[0] }.each do |label, path| %>
        <%= link_to label, path, class: "nav-link",
            data: {
              turbo_frame: "main-content",
              sidebar_search_target: "formLink",
              fields: form_field_labels[label] || "",
              tags: form_tags[label] || ""
            } %>
      <% end %>
    </div>
    
  <% else %>
    <p class="sidebar-p">Please log in to access forms.</p>
  <% end %>
</div>
