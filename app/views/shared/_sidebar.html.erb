<%# app/views/shared/_sidebar.html.erb %>
<button class="hamburger-btn" data-controller="sidebar" data-action="click->sidebar#toggle">
  <span class="navbar-toggler-icon"></span>
</button>

<!-- Overlay -->
<div class="sidebar-overlay" data-controller="sidebar" data-action="click->sidebar#close"></div>

<div class="sidebar" data-controller="sidebar-search">
  <h2>Available Forms</h2>
  <% if current_user %>
    <input 
      type="text" 
      placeholder="Search forms..." 
      data-sidebar-search-target="input"
      data-action="input->sidebar-search#filter"
      class="sidebar-search-input"
    />
    <% 
    # Most forms are public (available to all employees)
    public_forms = [
      ["Bike Locker Permit", new_bike_locker_permit_path],
      ["Jungle Book Form", new_jungle_book_form_path],
      ["Billing Tools", new_billing_tool_path],
      ["Carpool Form", new_carpool_form_path],
      ["Creative Job Request", new_creative_job_request_path],
      ["Critical Information Reporting", new_critical_information_reporting_path],
      ["Leave of Absence", new_loa_form_path],
      ["Parking Permit Application", new_parking_lot_submission_path],
      ["Probation Agency Transfer Request", new_probation_transfer_request_path],
      ["Chicago Bears Form", new_chicago_bears_form_path],
      ["Buffalo Bills Form", new_buffalo_bills_form_path],
      ["La Chargers Form", new_la_chargers_form_path],
      ["Seattle Seahawks Form", new_seattle_seahawks_form_path],
      ["Detroit Lions Form", new_detroit_lions_form_path],
      ["New England Patriots Form", new_new_england_patriots_form_path],
      ["Super Mario Form", new_super_mario_form_path],
      ["Princess Bride Form", new_princess_bride_form_path],
      ["Dallas Cowboys Form", new_dallas_cowboys_form_path],
      ["Chicago Blackhawks Form", new_chicago_blackhawks_form_path],
      ["Arizona Cardinals Form", new_arizona_cardinals_form_path],
    ]
    
    # Restricted forms - only for specific groups
    restricted_forms = [
      ["RM-75 Injury/Illness Report", new_rm75_form_path, ["Safety_Officers", "System_Admins"]],
      ["RM-75i Incident Investigation", new_rm75i_form_path, ["Safety_Officers", "System_Admins"]],
      ["Sonic The Hedgehog Form", new_sonic_the_hedgehog_form_path, ["System_Admins"]],
    ]
    
    # Build available forms list
    available_forms = public_forms.dup
    
    # Add restricted forms if user has access
    restricted_forms.each do |label, path, required_groups|
      if current_user.in_any_group?(*required_groups)
        available_forms << [label, path]
      end
    end
    %>
    <div data-sidebar-search-target="formsList">
      <% available_forms.sort_by { |f| f[0] }.each do |label, path| %>
        <%= link_to label, path, class: "nav-link", 
            data: { 
              turbo_frame: "main-content",
              sidebar_search_target: "formLink"
            } %>
      <% end %>
    </div>
    
  <% else %>
    <p class="sidebar-p">Please log in to access forms.</p>
  <% end %>
</div>
