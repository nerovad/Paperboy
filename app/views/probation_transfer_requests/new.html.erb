<div id="main-content">
  <div class="form-header">
    <h1>Probation Transfer Request</h1>
  </div>

  <div class="form-wrapper">
  <%= form_with model: @probation_transfer_request, local: true do |form| %> 

      <!-- Page 1: Employee Info -->
      <div class="form-page" style="display: block;">
        <h2>Employee Info</h2>
        <div class="form-row d-flex flex-wrap">
          <div class="form-group flex-fill">
            <%= form.label :employee_id, "Employee ID" %>
            <%= form.text_field :employee_id, value: @prefill_data[:employee_id], readonly: true, class: "form-control" %>
          </div>
          <div class="form-group flex-fill">
            <%= form.label :name, "Name" %>
            <%= form.text_field :name, value: @prefill_data[:name], readonly: true, class: "form-control" %>
          </div>
          <div class="form-group flex-fill">
            <%= form.label :phone, "Phone" %>
            <%= form.text_field :phone,
                  value: @prefill_data[:phone],
                  class: "form-control",
                  required: true,
                  placeholder: "e.g. 555-555-5555",
                  title: "Enter a 10-digit phone number like 555-555-5555",
                  data: {
                    controller: "phone",
                    phone_target: "input",
                    action: "input->phone#format paste->phone#format blur->phone#validate"
                  },
                  "aria-describedby": "phoneHelp phoneError",
                  pattern: "\\d{3}-\\d{3}-\\d{4}",
                  inputmode: "numeric",
                  autocomplete: "tel" %>

            <small id="phoneHelp" class="help-text text-muted"></small>
            <div id="phoneError" data-phone-target="error" class="field-error" aria-live="polite"></div>
            <% if @probation_transfer_request&.errors&.any? %>
            <% @probation_transfer_request.errors.full_messages_for(:phone).each do |msg| %>
                <div class="field-error active"><%= msg %></div>
              <% end %>
            <% end %>
          </div>
          <div class="form-group flex-fill">
            <%= form.label :email, "Email" %>
            <%= form.text_field :email, value: @prefill_data[:email], class: "form-control" %>
          </div>
        </div>
      </div>

      <!-- Page 2: Agency Info -->
      <div class="form-page" style="display: none;">
        <h2>Agency Info</h2>
        <div data-controller="gsabss-selects" class="form-row d-flex flex-wrap">
          <div class="form-group">
            <%= form.label :agency, "Agency" %>
            <%= form.select :agency,
              options_for_select(@agency_options, @prefill_data[:agency]),
              {},
              class: "form-control",
              id: "agency-select",
              data: {
                gsabss_selects_target: "agency",
                action: "change->gsabss-selects#loadDivisions"
              } %>
          </div>

          <div class="form-group">
            <%= form.label :division, "Division" %>
            <%= form.select :division,
              options_for_select(@division_options, @prefill_data[:division]),
              {},
              class: "form-control",
              id: "division-select",
              data: {
                gsabss_selects_target: "division",
                action: "change->gsabss-selects#loadDepartments"
              } %>
          </div>

          <div class="form-group">
            <%= form.label :department, "Department" %>
            <%= form.select :department,
              options_for_select(@department_options, @prefill_data[:department]),
              {},
              class: "form-control",
              id: "department-select",
              data: {
                gsabss_selects_target: "department",
                action: "change->gsabss-selects#loadUnits"
              } %>
          </div>

          <div class="form-group">
            <%= form.label :unit, "Unit" %>
            <%= form.select :unit,
              options_for_select(@unit_options, @prefill_data[:unit]),
              {},
              class: "form-control",
              id: "unit-select",
              data: {
                gsabss_selects_target: "unit"
              } %>
          </div>
        </div>
      </div>

      <!-- Page 3: Transfer Request Details -->
      <div class="form-page" style="display: none;">
        <h2>Transfer Request Details</h2>
        <div class="form-row d-flex flex-wrap">
          <div class="form-group flex-fill">
            <%= form.label :work_location, "Work Location" %>
            <%= form.select :work_location,
                options_for_select(@work_location_options, @probation_transfer_request&.work_location),
                {},
                class: "form-control" %>
          </div>

          <div class="form-group flex-fill">
            <%= form.label :current_assignment_date, "Current Assignment Start Date" %>
            <%= form.date_field :current_assignment_date, class: "form-control" %>
          </div>
          <div data-controller="probation-transfer-request">
            <div class="fieldset-grid">
              <!-- ADULT -->
              <fieldset class="fieldset">
                <legend>Adult Services Bureau</legend>
                <div class="form-group overflow-visible">
                  <label for="adult_select">Select one or more</label>
                  <select id="adult_select" class="form-control choices-multiselect" multiple
                          data-probation-transfer-request-target="adultSelect">
                    <%= options_for_select([
                      "Adult Investigations (AI-I, II, III)",
                      "East County Field Services (ECFS)",
                      "East County Probation/Post-Release (ECPPR)",
                      "Oxnard Field Services (OFS I/II)",
                      "Oxnard Probation/Post-Release (OPPR I/II)",
                      "Pretrial Risk Assessment and Monitoring Services (PRAMS)",
                      "Specialized Services Unit (SSU)",
                      "Ventura Field Services (VFS)",
                      "Ventura Probation/Post-Release (VPPR)",
                      "Work Release (WR)",
                      "Other"
                    ]) %>
                  </select>
                </div>
                <div class="form-group mt-2" data-probation-transfer-request-target="adultOtherGroup" style="display:none;">
                  <label>Other (Adult)</label>
                  <input type="text" class="form-control" data-probation-transfer-request-target="adultOtherInput">
                </div>
              </fieldset>

              <!-- JUVENILE -->
              <fieldset class="fieldset">
                <legend>Juvenile Services Bureau</legend>
                <div class="form-group overflow-visible">
                  <label for="juvenile_select">Select one or more</label>
                  <select id="juvenile_select" class="form-control choices-multiselect" multiple
                          data-probation-transfer-request-target="juvenileSelect">
                    <%= options_for_select([
                      "Intensive Supervision Services - Juvenile (ISSJ)",
                      "Juvenile Facilities Housing/Operations (JF)",
                      "Juvenile Field Services (JFS)",
                      "Juvenile Intake/Community Confinement (JINT/CC)",
                      "Juvenile Investigations (JINV)",
                      "Juvenile Specialty Programs (JSP)",
                      "Placement Unit (PLAU)",
                      "Other"
                    ]) %>
                  </select>
                </div>
                <div class="form-group mt-2" data-probation-transfer-request-target="juvenileOtherGroup" style="display:none;">
                  <label>Other (Juvenile)</label>
                  <input type="text" class="form-control" data-probation-transfer-request-target="juvenileOtherInput">
                </div>
              </fieldset>

              <!-- ADMIN -->
              <fieldset class="fieldset">
                <legend>Administrative Services</legend>
                <div class="form-group overflow-visible">
                  <label for="admin_select">Select one or more</label>
                  <select id="admin_select" class="form-control choices-multiselect" multiple
                          data-probation-transfer-request-target="adminSelect">
                    <%= options_for_select([
                      "Force Options Training (FOT)",
                      "Professional Standards Unit (PSU)",
                      "Staff Training Unit (STU)",
                      "Other"
                    ]) %>
                  </select>
                </div>
                <div class="form-group mt-2" data-probation-transfer-request-target="adminOtherGroup" style="display:none;">
                  <label>Other (Administrative)</label>
                  <input type="text" class="form-control" data-probation-transfer-request-target="adminOtherInput">
                </div>
              </fieldset>
            </div>

            <!-- The ONLY field bound to your model column -->
            <%= form.hidden_field :desired_transfer_destination,
                  id: "combined_transfer_destination",
                  value: @probation_transfer_request&.desired_transfer_destination,
                  data: { probation_transfer_request_target: "combinedField" } %>
          </div>

      </div>
        </div>

      <!-- Navigation Buttons -->
      <div class="navigation-buttons d-flex justify-content-between">
        <div>
          <button type="button" id="prevBtn" style="display: none;">Previous</button>
        </div>
        <div>
          <button type="button" id="nextBtn">Next</button>
          <%= form.submit "Submit", id: "submitButton", style: "display: none;" %>
        </div>
      </div>

      <!-- Progress Dots -->
      <div class="progress-dots">
        <% 3.times do |index| %>
          <div class="dot <%= 'active' if index == 0 %>"></div>
        <% end %>
      </div>
    <% end %>
  </div>
  </div>
