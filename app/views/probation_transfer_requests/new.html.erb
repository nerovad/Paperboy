<turbo-frame id="main-content">
  <div class="form-header">
    <h1>Probation Transfer Request</h1>
  </div>

  <div class="form-wrapper">
    <%= form_with model: @probation_transfer_request, local: true, data: { controller: "form-navigation", form_navigation_target: "submitButton" } do |form| %>
      <% @form_pages.each_with_index do |page, page_index| %>
        <div class="form-page" style="<%= page_index == 0 ? '' : 'display:none;' %>">
          <h2><%= page[:title] %></h2>

          <% if page[:title] == "Agency Info" %>
            <div data-controller="gsabss-selects" class="form-row d-flex flex-wrap">
              <div class="form-group">
                <%= form.label :agency, "Agency" %>
                <%= form.select :agency,
                      options_for_select(@agency_options, @prefill_data[:agency]),
                      {},
                      class: "form-control",
                      id: "agency-select",
                      data: {
                        gsabss_selects_target: "agency",
                        action: "change->gsabss-selects#loadDivisions"
                      } %>
              </div>

              <div class="form-group">
                <%= form.label :division, "Division" %>
                <%= form.select :division,
                      options_for_select(@division_options, @prefill_data[:division]),
                      {},
                      class: "form-control",
                      id: "division-select",
                      data: {
                        gsabss_selects_target: "division",
                        action: "change->gsabss-selects#loadDepartments"
                      } %>
              </div>

              <div class="form-group">
                <%= form.label :department, "Department" %>
                <%= form.select :department,
                      options_for_select(@department_options, @prefill_data[:department]),
                      {},
                      class: "form-control",
                      id: "department-select",
                      data: {
                        gsabss_selects_target: "department",
                        action: "change->gsabss-selects#loadUnits"
                      } %>
              </div>

              <div class="form-group">
                <%= form.label :unit, "Unit" %>
                <%= form.select :unit,
                      options_for_select(@unit_options, @prefill_data[:unit]),
                      {},
                      class: "form-control",
                      id: "unit-select",
                      data: {
                        gsabss_selects_target: "unit"
                      } %>
              </div>
            </div>
          <% else %>
            <div class="form-row d-flex flex-wrap">
              <% page[:fields]&.each do |field| %>
                <div class="form-group flex-fill" style="min-width: 200px;">
                  <%= form.label field[:name], field[:label] %>

                  <% case field[:type] %>
                  <% when 'select' %>
                    <%= form.select field[:name],
                          options_for_select(field[:options], @prefill_data[field[:name]]),
                          {},
                          class: "form-control" %>

                  <% when 'multi-select' %>
                    <%= form.select field[:name],
                          options_for_select(field[:options], @prefill_data[field[:name]]),
                          {},
                          multiple: true,
                          class: "form-control choices-multiselect",
                          id: "#{field[:name]}_select" %>

                  <% else %>
                    <%= form.text_field field[:name],
                          value: @prefill_data[field[:name]],
                          required: field[:required],
                          class: "form-control" %>
                  <% end %>
                </div>
              <% end %>
            </div>
          <% end %>
        </div>
      <% end %>

      <!-- Navigation Buttons -->
      <div class="navigation-buttons d-flex justify-content-between">
        <div>
          <button type="button" id="prevBtn" style="display: none;">Previous</button>
        </div>
        <div>
          <button type="button" id="nextBtn">Next</button>
          <%= form.submit "Submit", id: "submitButton", style: "display: none;" %>
        </div>
      </div>

      <!-- Progress Dots -->
      <div class="progress-dots">
        <% @form_pages.each_with_index do |_, index| %>
          <div class="dot <%= 'active' if index == 0 %>"></div>
        <% end %>
      </div>
    <% end %>
  </div>
</turbo-frame>
