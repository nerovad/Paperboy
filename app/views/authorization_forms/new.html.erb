<!-- lib/generators/paperboy_form/templates/views/new.html.erb.tt -->
<div class="form-header">
  <h1>Authorization Form</h1>
</div>

<div class="form-wrapper" data-controller="form-navigation">
  <%= form_with model: @authorization_form, local: true do |form| %>

    <!-- Page 1: Employee Info -->
    <div class="form-page">
      <h2>Employee Info</h2>
      <div class="form-row d-flex flex-wrap">
        <div class="form-group flex-fill">
          <%= form.label :employee_id, "Employee ID" %>
          <%= form.text_field :employee_id,
                value: @prefill_data[:employee_id],
                class: "form-control",
                readonly: true %>
        </div>

        <div class="form-group flex-fill">
          <%= form.label :name, "Name" %>
          <%= form.text_field :name,
                value: @prefill_data[:name],
                class: "form-control",
                readonly: true %>
        </div>

        <div class="form-group flex-fill">
          <%= form.label :phone, "Phone" %>
          <%= form.text_field :phone,
                value: @prefill_data[:phone],
                class: "form-control",
                required: true,
                placeholder: "e.g. 555-555-5555",
                title: "Enter a 10-digit phone number like 555-555-5555",
                data: {
                  controller: "phone",
                  phone_target: "input",
                  action: "input->phone#format paste->phone#format blur->phone#validate"
                },
                "aria-describedby": "phoneHelp phoneError",
                pattern: "\\d{3}-\\d{3}-\\d{4}",
                inputmode: "numeric",
                autocomplete: "tel" %>
          <small id="phoneHelp" class="help-text text-muted"></small>
          <div id="phoneError" data-phone-target="error" class="field-error" aria-live="polite"></div>
        </div>

        <div class="form-group flex-fill">
          <%= form.label :email, "Email" %>
          <%= form.text_field :email,
                value: @prefill_data[:email],
                class: "form-control",
                required: true %>
        </div>
      </div>
    </div>

    <!-- Page 2: Agency Info -->
    <div class="form-page" style="display:none;">
      <h2>Agency Info</h2>

      <div data-controller="gsabss-selects" class="form-row d-flex flex-wrap">
        <div class="form-group">
          <%= form.label :agency, "Agency" %>
          <%= form.select :agency,
                options_for_select(@agency_options, @prefill_data[:agency]),
                {},
                class: "form-control",
                id: "agency-select",
                data: {
                  gsabss_selects_target: "agency",
                  action: "change->gsabss-selects#loadDivisions"
                } %>
        </div>

        <div class="form-group">
          <%= form.label :division, "Division" %>
          <%= form.select :division,
                options_for_select(@division_options, @prefill_data[:division]),
                {},
                class: "form-control",
                id: "division-select",
                data: {
                  gsabss_selects_target: "division",
                  action: "change->gsabss-selects#loadDepartments"
                } %>
        </div>

        <div class="form-group">
          <%= form.label :department, "Department" %>
          <%= form.select :department,
                options_for_select(@department_options, @prefill_data[:department]),
                {},
                class: "form-control",
                id: "department-select",
                data: {
                  gsabss_selects_target: "department",
                  action: "change->gsabss-selects#loadUnits"
                } %>
        </div>

        <div class="form-group">
          <%= form.label :unit, "Unit" %>
          <%= form.select :unit,
                options_for_select(@unit_options, @prefill_data[:unit]),
                {},
                class: "form-control",
                id: "unit-select",
                data: { gsabss_selects_target: "unit" } %>
        </div>
      </div>
    </div>

    <!-- Page 3: Authorization Info -->
    <div class="form-page" style="display:none;">
      <h2>Authorization Info</h2>

      <div data-controller="authorization-select" class="form-row d-flex flex-wrap">
        <div class="form-group">
          <%= form.label :service_type, "Service Type" %>
          <%= form.select :service_type,
                options_for_select([
                  ["Parking Permit (P)", "P"],
                  ["Employee Identification Badges (E)", "E"],
                  ["Volunteer ID Badges (V)", "V"],
                  ["Vendor ID Badges (C)", "C"],
                  ["Facility Keys and Security Access (K)", "K"]
                ], @prefill_data[:service_type]),
                { prompt: "Select a service type" },
                class: "form-control",
                required: true,
                data: {
                  authorization_select_target: "serviceType",
                  action: "change->authorization-select#toggleKeyType"
                } %>
        </div>

        <div class="form-group" id="key-type-wrapper" style="display:none;">
          <%= form.label :key_type, "Type of Service" %>
          <%= form.select :key_type,
                options_for_select([
                  ["1 = Master Keys", "1"],
                  ["2 = Access Cards", "2"],
                  ["3 = Site Keys", "3"],
                  ["4 = Area / Room Keys", "4"],
                  ["5 = Perimeter Fence Gates", "5"],
                  ["6 = Equipment Closet Keys", "6"],
                  ["7 = File/Desk/Storage Cabinet Keys", "7"]
                ], @prefill_data[:key_type]),
                { prompt: "Select key type" },
                class: "form-control",
                data: { authorization_select_target: "keyType" } %>
        </div>

        <div class="form-group">
          <%= form.label :budget_units, "Budget Units" %>
          <%= form.select :budget_units,
                options_for_select([
                  ["A = All Budget Units - All Locations", "A"],
                  ["B = Multiple Budget Units - All Locations", "B"],
                  ["C = Multiple Budget Units - Multiple Locations", "C"],
                  ["D = Single Budget Unit - Multiple Locations", "D"],
                  ["E = Single Budget Unit - Single Location", "E"]
                ], @prefill_data[:budget_units]),
                { prompt: "Select budget units" },
                class: "form-control",
                required: true %>
        </div>
      </div>
    </div>

    <!-- Navigation Buttons -->
    <div class="navigation-buttons d-flex justify-content-between">
      <div>
        <button type="button" id="prevBtn" data-action="click->form-navigation#prevPage" style="display:none;">Previous</button>
      </div>
      <div>
        <button type="button" id="nextBtn" data-action="click->form-navigation#nextPage">Next</button>
        <%= form.submit "Submit", data: { form_navigation_target: "submitButton" }, style: "display:none;" %>
      </div>
    </div>

    <!-- Progress (2 steps) -->
    <div class="progress-wrapper">
      <div class="progress-bar-container">
        <div class="progress-bar" id="progressBar"></div>
      </div>
      <div class="progress-dots">
        <% 3.times do |index| %>
          <div class="dot <%= 'active' if index == 0 %>"></div>
        <% end %>
      </div>
    </div>

  <% end %>
</div>
