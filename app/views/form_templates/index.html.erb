<!-- app/views/form_templates/index.html.erb -->
<div class="form-header">
  <h1>Form Templates</h1>
</div>

<div class="form-wrapper form-templates" data-controller="sidebar-search">
  <div class="department-header">
    <h2>Manage Form Templates</h2>
    <button type="button"
            class="btn approve"
            data-controller="form-builder"
            data-action="click->form-builder#openModal">
      + Create Form
    </button>
  </div>

  <input
    type="text"
    placeholder="Search templates, fields, tags..."
    data-sidebar-search-target="input"
    data-action="input->sidebar-search#filter"
    class="template-search-input"
  />

  <% if @form_templates.any? %>
    <div class="approvers-list" data-sidebar-search-target="formsList">
      <% @form_templates.each do |template| %>
        <div class="approver-card"
             data-sidebar-search-target="formLink"
             data-search-card
             data-original-name="<%= template.name %>"
             data-fields="<%= template.form_fields.map(&:label).join(', ') %>"
             data-tags="<%= template.tags_array.join(', ') %>">
          <div class="approver-header">
            <h3>
              <%= template.name %>
              <span class="employee-id">(<%= template.class_name %>)</span>
            </h3>
          </div>

          <div class="approvals-list">
            <div class="approval-item">
              <div class="approval-details">
                <div class="detail-row">
                  <span class="label">Table Name:</span>
                  <span class="value"><code><%= template.table_name %></code></span>
                </div>

                <div class="detail-row">
                  <span class="label">Access:</span>
                  <span class="value">
                    <span class="badge <%= template.restricted? ? 'badge-warning' : 'badge-success' %>">
                      <%= template.access_level.titleize %>
                    </span>
                    <% if template.restricted? %>
                      - <%= template.acl_group_name %>
                    <% end %>
                  </span>
                </div>

                <div class="detail-row">
                  <span class="label">Pages:</span>
                  <span class="value"><%= template.page_count %></span>
                </div>

                <div class="detail-row">
                  <span class="label">Fields:</span>
                  <span class="value"><%= template.form_fields.count %></span>
                </div>

                <div class="detail-row">
                  <span class="label">Created:</span>
                  <span class="value"><%= template.created_at.strftime("%m/%d/%Y at %I:%M %p") %></span>
                </div>
              </div>

              <div class="approval-actions">
                <%= link_to "View Details", form_template_path(template), class: "btn" %>
                <%= link_to "Edit", edit_form_template_path(template), class: "btn approve" %>
                <%= button_to "Delete",
                              form_template_path(template),
                              method: :delete,
                              class: "btn deny",
                              data: { confirm: "Are you sure? This will delete the form template and all generated files." } %>
              </div>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  <% else %>
    <div class="empty-state">
      <p>No form templates have been created yet.</p>
      <p class="empty-state-hint">Click "+ Create Form" to get started.</p>
    </div>
  <% end %>
</div>

<!-- Render the modal on this page -->
<%= render "form_templates/create_modal", acl_groups: @acl_groups, employees: @employees %>
