<!DOCTYPE html>
<html>
  <head>
    <title>üì∞ Paperboy - Ventura</title>
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>
    <link rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/choices.js@10.2.0/public/assets/styles/choices.min.css" />
    <%= stylesheet_link_tag "application", media: "all", "data-turbo-track": "reload" %>
    <script src="https://cdn.jsdelivr.net/npm/choices.js@10.2.0/public/assets/scripts/choices.min.js"></script>
    <%= javascript_importmap_tags %>
  </head>
  <body class="page-<%= "#{controller_name}-#{action_name}" %> controller-<%= controller_name %>">
   <!-- Impersonation Banner -->
   <% if session[:impersonating] %>
     <div style="background: #ff9800; color: white; padding: 10px; text-align: center;">
       ‚ö†Ô∏è You are impersonating <%= session[:user]["first_name"] %> <%= session[:user]["last_name"] %>
       <%= button_to "Stop Impersonating", admin_impersonation_path(1), 
                     method: :delete, 
                     class: "btn btn-sm btn-light" %>
     </div>
   <% end %>
   
   <%= render "shared/logo" %>
  <div class="app-container">
    <%= render "shared/sidebar" %>
    <div class="content-container">
      <div id="main-content">
        <% if content_for?(:image) %>
          <%= yield :image %>
        <% else %>
          <%= yield %>
        <% end %>
        
        <!-- Login Button (over image) -->
        <% unless session[:user_id] %>
          <%= form_with url: "/auth/azure_activedirectory_v2", method: :post, 
                        data: { turbo: false } do |f| %>
            <%= f.submit "Login with Microsoft", class: "login-button-over-image" %>
          <% end %>
        <% else %>
          <div class="profile-dropdown" data-controller="profile-dropdown">
            <button id="profile-toggle"
                    class="profile-icon"
                    data-action="click->profile-dropdown#toggle">
              <%= session[:user]["first_name"] %>
              <% if inbox_count > 0 %>
                <span class="inbox-badge"><%= inbox_count %></span>
              <% end %>
            </button>
            <div class="dropdown-content"
                 data-profile-dropdown-target="dropdown">
              <%= link_to "Inbox Queue", inbox_queue_path, class: "btn btn-primary" %>
              <%= link_to "Status", status_path, class: "btn btn-primary" %>
              
              <% if session[:user_id] == 136626 %> <!-- Your employee ID -->
                <%= link_to "Impersonate", new_admin_impersonation_path, class: "btn btn-warning" %>
              <% end %>
              
              <%= button_to "Logout", logout_path, method: :delete, class: "logout-btn" %>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</body>
</html>
